<!DOCTYPE html>
<html>
<head>
    <title>Survey Management</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Survey Management</h1>
            <a href="/create.html" class="button create-btn">Create New Survey</a>
        </div>

        <h2>Existing Surveys</h2>
        <ul id="surveyList"></ul>
    </div>

    <script>
        const surveyList = document.getElementById("surveyList");

        async function loadSurveys() {
            try {
                const response = await fetch("/surveys");
                if (response.ok) {
                    const surveys = await response.json();
                    surveyList.innerHTML = "";
                    surveys.forEach((survey) => {
                        const listItem = document.createElement("li");
                        listItem.innerHTML = `
                            <div class="survey-info">
                                <span class="survey-name">${survey.name}</span>
                            </div>
                            <div class="survey-actions">
                                <a href="/survey/${survey.uniqueUrl}" target="_blank" class="view-btn">View</a>
                                <button class="edit-btn" data-id="${survey._id}">Edit</button>
                                <button class="delete-btn" data-id="${survey._id}">Delete</button>
                            </div>
                        `;
                        surveyList.appendChild(listItem);

                        const editButton = listItem.querySelector(".edit-btn");
                        editButton.addEventListener("click", () => {
                            const surveyId = editButton.dataset.id;
                            window.location.href = `/edit.html?id=${surveyId}`;
                        });

                        const deleteButton = listItem.querySelector(".delete-btn");
                        deleteButton.addEventListener("click", () => {
                            const surveyId = deleteButton.dataset.id;
                            deleteSurvey(surveyId);
                        });
                    });
                } else {
                    console.error("Error loading surveys");
                }
            } catch (error) {
                console.error("Error:", error);
            }
        }

        async function deleteSurvey(surveyId) {
            if (confirm("Are you sure you want to delete this survey?")) {
                try {
                    const response = await fetch(`/surveys/${surveyId}`, {
                        method: "DELETE",
                    });

                    if (response.ok) {
                        alert("Survey deleted successfully");
                        loadSurveys();
                    } else {
                        alert("Error deleting survey");
                    }
                } catch (error) {
                    console.error("Error:", error);
                    alert("Error deleting survey");
                }
            }
        }

        // Initial load of surveys
        loadSurveys();
    </script>
</body>
</html>